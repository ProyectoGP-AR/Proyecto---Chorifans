{% extends "base.html" %}
{% load static %}

{% block title %}Valorar rese침as - ChoriFans{% endblock %}

{% block content %}
<section class="seccion seccion--valorar-resenas">
  <div class="valorar-resenas-container">

    <h1 class="valorar-resenas-titulo">
      Valorar rese침as
    </h1>

    <p class="valorar-resenas-subtitulo">
      Respond칠 y valor치 las rese침as que hicieron sobre tu parrilla.
    </p>

    {% if resenas %}
      <div class="resenas-list">
        {% for resena in resenas %}
          <article class="resena-card resena-card--panel">

            {# CABECERA-POST COMPLETA (nombre + comentario + fecha) #}
            <header class="resena-header">
              <div class="resena-header__info">

                {# Nombre + choripanes (arriba) #}
                <div class="resena-usuario">
                  <span class="resena-usuario-nombre">
                    @{{ resena.usuario.username }}
                  </span>
                  <span class="resena-puntaje-choris">
                    {% for i in "12345"|make_list %}
                      {% if forloop.counter <= resena.puntaje %}
                        游꺐
                      {% endif %}
                    {% endfor %}
                  </span>
                </div>

                {# Comentario del usuario va EN EL MEDIO #}
                <p class="resena-texto">
                  {{ resena.comentario }}
                </p>

                {# Fecha + parrilla (abajo) #}
                <div class="resena-meta">
                  {{ resena.created_at|date:"d/m/Y H:i" }}
                  췅 {{ resena.parrilla.nombre }}
                </div>

              </div>
            </header>

            {# ===  RESPUESTA DE LA PARRILLA (si existe) === #}
            {% if resena.respuesta_parrilla %}
              <div class="respuesta-parrilla-card">
                <div class="respuesta-header">
                  <span class="respuesta-nombre-parrilla">
  {{ resena.parrilla.nombre|upper }}
</span>

        <span
          class="respuesta-verificado-icon"
          aria-hidden="true"
          style="background-image: url('{% static "css/img/verified.png" %}');"
        ></span>

        <span class="respuesta-valoracion">
          {% if resena.respuesta_parrilla.valoracion == "happy" %}
            游땕
          {% else %}
            驕좶잺
          {% endif %}
        </span>


                </div>

                <p class="respuesta-texto">
                  {{ resena.respuesta_parrilla.texto }}
                </p>

                <p class="respuesta-meta">
                  Respuesta oficial 췅
                  {{ resena.respuesta_parrilla.updated_at|date:"d/m/Y H:i" }}
                </p>
              </div>
            {% else %}
              <p class="resena-estado--pendiente">
                Esta rese침a a칰n no tiene respuesta oficial de la parrilla.
              </p>
            {% endif %}

            {# Bot칩n de acci칩n: crear o editar respuesta #}
            <div class="resena-acciones">
              <a
                href="{% url 'resenas:responder_resena' resena.id %}"
                class="btn-ver btn-responder"
              >
                {% if resena.respuesta_parrilla %}
                  Editar respuesta
                {% else %}
                  Responder rese침a
                {% endif %}
              </a>
            </div>

          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="resena-empty">
        No hay rese침as pendientes para tu parrilla en este momento.
      </p>
    {% endif %}

  </div>
</section>
{% endblock %}
