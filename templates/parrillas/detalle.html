{% extends "base.html" %}

{% block title %}{{ parrilla.nombre }} - ChoriFans{% endblock %}

{% block content %}
  <div class="parrilla-detalle-container">
    <h1 class="parrilla-detalle-titulo">
      {{ parrilla.nombre }}
    </h1>

    <div class="parrilla-detalle-layout">
      <div class="parrilla-detalle-foto">
        {% if parrilla.foto_principal %}
          <img
            src="{{ parrilla.foto_principal.url }}"
            alt="Foto de {{ parrilla.nombre }}"
            class="parrilla-detalle-img"
          />
        {% else %}
          <p>Sin foto disponible.</p>
        {% endif %}
      </div>

      <div class="parrilla-detalle-info">
        <p><strong>Direcci√≥n:</strong> {{ parrilla.direccion }}</p>

        {% if parrilla.telefono %}
          <p><strong>Tel√©fono:</strong> {{ parrilla.telefono }}</p>
        {% endif %}

        {% if parrilla.sitio_web %}
          <p>
            <strong>Sitio web:</strong>
            <a href="{{ parrilla.sitio_web }}" target="_blank" rel="noopener noreferrer">
              {{ parrilla.sitio_web }}
            </a>
          </p>
        {% endif %}

        <p>
          <strong>Ubicaci√≥n:</strong>
          {{ parrilla.ubicacion.nombre_barrio }} - {{ parrilla.ubicacion.nombre_ciudad }}
        </p>

        <p>
          <strong>Categor√≠a:</strong>
          {{ parrilla.categoria.nombre }}
        </p>

        <p>
          <strong>Descripci√≥n:</strong><br />
          {{ parrilla.descripcion }}
        </p>

        <p>
          <strong>Puntaje promedio:</strong>
          {% if parrilla.promedio_puntaje %}
            {{ parrilla.promedio_puntaje }} / 5
          {% else %}
            Sin puntajes todav√≠a.
          {% endif %}
        </p>
      </div>
    </div>

    <!-- Rese√±as de la parrilla -->
    <div class="parrilla-detalle-resenas">
      <h2 class="parrilla-detalle-subtitulo">
        Rese√±as de la comunidad
      </h2>

      {% if resenas %}
        <ul class="resenas-lista">
          {% for r in resenas %}
            <li class="resena-item">
              <div class="resena-header">
                <span class="resena-puntaje">
                  {{ r.get_puntaje_display }}
                </span>
                <span class="resena-usuario">
                  por {{ r.usuario.username }}
                </span>
                <span class="resena-fecha">
                  {{ r.created_at|date:"d/m/Y H:i" }}
                </span>
              </div>

              <p class="resena-comentario">
                {{ r.comentario }}
              </p>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="resena-empty">
          No hay rese√±as todav√≠a. ¬°S√© el primero en opinar!
        </p>
      {% endif %}
    </div>

    <!-- Promociones vigentes -->
    <div class="parrilla-detalle-promos">
      <h2 class="parrilla-detalle-subtitulo">
        Promociones vigentes
      </h2>

      {% if promociones %}
        <ul class="promos-lista">
          {% for promo in promociones %}
            <li class="promo-item">
              <div class="promo-header">
                <h3 class="promo-titulo">{{ promo.titulo }}</h3>

                {% if promo.precio_promocional %}
                  <span class="promo-precio">
                    $ {{ promo.precio_promocional }}
                  </span>
                {% endif %}
              </div>

              <p class="promo-descripcion">
                {{ promo.descripcion }}
              </p>

              <p class="promo-fechas">
                V√°lida del {{ promo.fecha_inicio|date:"d/m/Y" }}
                al {{ promo.fecha_fin|date:"d/m/Y" }}
              </p>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="promo-empty">
          No hay promociones vigentes para esta parrilla en este momento.
        </p>
      {% endif %}
    </div>

    <!-- Formulario para dejar rese√±a -->
    <div class="resena-formulario">
      <h2 class="parrilla-detalle-subtitulo">Tu rese√±a</h2>

      {% if user.is_authenticated %}

        {% if ya_rese√±o %}
          <p class="resena-ya-hecha">
            Ya dejaste una rese√±a para esta parrilla üòä
          </p>

        {% elif puede_rese√±ar %}
          <form method="POST" class="resena-form">
            {% csrf_token %}
            {{ form.as_p }}

            <button type="submit" class="btn btn-primary">
              Publicar rese√±a
            </button>
          </form>
        {% endif %}

      {% else %}
        <p class="resena-login-msg">
          Para dejar una rese√±a necesit√°s
          <a href="{% url 'accounts:login' %}">iniciar sesi√≥n</a>.
        </p>
      {% endif %}
    </div>

      <p class="volver-inicio">
        <a href="{% url 'home' %}" class="volver-inicio-link">
          ‚Üê Volver al inicio
        </a>
      </p>
  </div>
{% endblock %}
